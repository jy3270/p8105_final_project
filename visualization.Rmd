---
title: "Visualization"
output: 
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
---

```{r, include = FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(ggplot2)
library(plotly)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d

select <- dplyr::select
```


```{r, include = FALSE, message=FALSE, warning=FALSE}
happ_df = read_csv("Data/happiness.csv")
```


### Life Ladder Scores Based on Different Regions

#### Overall mean life ladder score
We want to first get a general sense about the differences among life ladder scores for different regions by plotting the mean life ladder score for each region throughout the years.
```{r}
happ_df %>%
  group_by(regional_indicator) %>%
  summarise(mean_ladder_score = mean(ladder_score)) %>%
  mutate(regional_indicator = fct_reorder(regional_indicator, mean_ladder_score, .desc = TRUE)) %>%
  ggplot(aes(x = regional_indicator, y = mean_ladder_score, fill = regional_indicator)) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  coord_flip() +
  labs(
    y = "Mean life ladder score",
    x = "Region",
    title = "Mean Life Ladder Score for Different Regions"
  )
```

From the years 2005 to 2021, North America and ANZ region has the highest mean life ladder score. Western Europe region has the second highest mean ladder score and is close to North America and ANZ's. Sub-Saharan Africa and South Asia have the two lowest mean life ladder scores in which Sub-Saharan Africa has the lowest mean life ladder score.

#### Across Years 2005 to 2021
After getting an idea of the differences of mean life ladder score among different regions, we want to explore the distribution of life ladder score on each region across the years.

```{r, fig.width = 11.5, fig.height = 6.5}
happ_df %>%
  filter(year != 2005) %>%
  ggplot(aes(x = year, y = ladder_score, group = year)) +
  geom_boxplot() +
  theme(
    axis.text.x = element_text(angle = 60, vjust = 0.5, hjust = 1, margin = margin(-10, 0, 0, 0)),
    axis.title.x = element_text(margin = margin(15, 0, 0, 0))
  ) +
  facet_wrap(~regional_indicator, nrow = 2) +
  labs(
    x = "Year",
    y = "Life ladder score",
    title = "Life Ladder Scores for Different Regions Across Years"
  ) 
```

With the initial idea that the mean life ladder score of the North America and ANZ region being the highest, we can see that each year the life ladder score of the North America and ANZ region has similar distribution around 7. For Sub-Saharan Africa, it also has similar distribution in life ladder score around 4 across the years. It seems that the Middle East and North Africa region has many outliers in each year's life ladder score.

#### Mean life ladder score for top 50 countries
Now we want to look at the countries that have top 50 mean life ladder score and which regions they belong to.
```{r, message=FALSE, fig.width = 11.5, fig.height = 5.5}
happ_df %>%
  group_by(country_name, regional_indicator) %>%
  summarise(mean = mean(ladder_score)) %>%
  ungroup() %>%
  top_n(50, mean) %>%
  mutate(country_name = fct_reorder(country_name, mean)) %>%
  ggplot(aes(x = country_name, y = mean, color = regional_indicator)) +
  geom_point(stat = "identity") +
  theme(axis.text.x = element_text(angle = 60, vjust = 1, hjust = 1),
        legend.position = "top") +
  labs(
    x = "Country",
    y = "Mean life ladder score",
    color = "Region"
  )
  
```

Interestingly, there are many countries from Western Europe and they also have relatively high mean life ladder score across the years.

### Other variables Based on Different Regions {.tabset}

#### Logged GDP per capita
We can see that the distributions in North America and ANZ, and Western Europe are similar in logged GDP per capita and they are the two highest among these regions.

```{r, fig.width = 11.5, fig.height = 6.5}
happ_df %>%
  filter(year != 2005) %>%
  ggplot(aes(x = year, y = logged_gdp_per_capita, group = year)) +
  geom_boxplot() +
  theme(
    axis.text.x = element_text(angle = 60, vjust = 0.5, hjust = 1, margin = margin(-10, 0, 0, 0)),
    axis.title.x = element_text(margin = margin(15, 0, 0, 0))
  ) +
  facet_wrap(~regional_indicator, nrow = 2) +
  labs(
    x = "Year",
    y = "Logged GDP per capita",
    title = "Logged GDP per capita for Different Regions Across Years"
  ) 
```

#### Social Support

```{r, fig.width = 11.5, fig.height = 6.5}
happ_df %>%
  filter(year != 2005) %>%
  ggplot(aes(x = year, y = social_support, group = year)) +
  geom_boxplot() +
  theme(
    axis.text.x = element_text(angle = 60, vjust = 0.5, hjust = 1, margin = margin(-10, 0, 0, 0)),
    axis.title.x = element_text(margin = margin(15, 0, 0, 0))
  ) +
  facet_wrap(~regional_indicator, nrow = 2) +
  labs(
    x = "Year",
    y = "Social support",
    title = "Social Support for Different Regions Across Years"
  ) 
```

#### Healthy life expectancy
```{r, fig.width = 11.5, fig.height = 6.5}
happ_df %>%
  filter(year != 2005) %>%
  ggplot(aes(x = year, y = healthy_life_expectancy, group = year)) +
  geom_boxplot() +
  theme(
    axis.text.x = element_text(angle = 60, vjust = 0.5, hjust = 1, margin = margin(-10, 0, 0, 0)),
    axis.title.x = element_text(margin = margin(15, 0, 0, 0))
  ) +
  facet_wrap(~regional_indicator, nrow = 2) +
  labs(
    x = "Year",
    y = "Healthy life expectancy",
    title = "Healthy Life Expectancy for Different Regions Across Years"
  ) 
```

#### Freedom to make life chocies
```{r, fig.width = 11.5, fig.height = 6.5}
happ_df %>%
  filter(year != 2005) %>%
  ggplot(aes(x = year, y = freedom_to_make_life_choices, group = year)) +
  geom_boxplot() +
  theme(
    axis.text.x = element_text(angle = 60, vjust = 0.5, hjust = 1, margin = margin(-10, 0, 0, 0)),
    axis.title.x = element_text(margin = margin(15, 0, 0, 0))
  ) +
  facet_wrap(~regional_indicator, nrow = 2) +
  labs(
    x = "Year",
    y = "Freedom to make life choices",
    title = "Freedom for Different Regions Across Years"
  ) 
```

#### Generosity
```{r, fig.width = 11.5, fig.height = 6.5}
happ_df %>%
  filter(year != 2005) %>%
  ggplot(aes(x = year, y = generosity, group = year)) +
  geom_boxplot() +
  theme(
    axis.text.x = element_text(angle = 60, vjust = 0.5, hjust = 1, margin = margin(-10, 0, 0, 0)),
    axis.title.x = element_text(margin = margin(15, 0, 0, 0))
  ) +
  facet_wrap(~regional_indicator, nrow = 2) +
  labs(
    x = "Year",
    y = "Generosity",
    title = "Generosity for Different Regions Across Years"
  ) 
```

#### Perceptions of corruption
```{r, fig.width = 11.5, fig.height = 6.5}
happ_df %>%
  filter(year != 2005) %>%
  ggplot(aes(x = year, y = perceptions_of_corruption, group = year)) +
  geom_boxplot() +
  theme(
    axis.text.x = element_text(angle = 60, vjust = 0.5, hjust = 1, margin = margin(-10, 0, 0, 0)),
    axis.title.x = element_text(margin = margin(15, 0, 0, 0))
  ) +
  facet_wrap(~regional_indicator, nrow = 2) +
  labs(
    x = "Year",
    y = "Perceptions of corruption",
    title = "Perceptions of Corruption for Different Regions Across Years"
  ) 
```

